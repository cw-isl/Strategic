<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì „ëµë¬¼ì 1ì°¨ ìê°€íŒë³„ (í”„ë¡œí† íƒ€ì…)</title>
  <style>
    :root{--fg:#111;--muted:#666;--line:#ddd;--bg:#fff;--chip:#f6f6f6}
    *{box-sizing:border-box} html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans KR",sans-serif}
    .container{max-width:880px;margin:0 auto;padding:24px}
    h1{font-size:clamp(22px,3.5vw,28px);margin:0 0 8px}
    p{margin:0}
    .muted{color:var(--muted)}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{display:inline-flex;align-items:center;border:1px solid #00000022;border-radius:999px;padding:2px 8px;font-size:12px;background:var(--chip)}
    .card{border:1px solid var(--line);border-radius:16px;padding:20px;box-shadow:0 2px 6px #0000000a;background:#fff}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .btn{appearance:none;border-radius:16px;border:1px solid #00000030;background:#fff;padding:10px 16px;font-weight:600;cursor:pointer;transition:transform .04s ease, box-shadow .2s ease}
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:#111;color:#fff;border-color:#111}
    .btn.link{border-color:transparent;text-decoration:underline;color:#333}
    .btn.ghost{color:#444}
    .btn.success{background:#16a34a;color:#fff;border-color:#16a34a}
    .progress{height:8px;border-radius:999px;background:#00000012;overflow:hidden}
    .bar{height:8px;background:#111;width:0}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid var(--line);padding:8px 12px;text-align:left;vertical-align:top}
    th{color:#555;font-weight:600}
    .dotline{display:flex;gap:6px}
    .dot{width:10px;height:10px;border-radius:999px;background:#00000020}
    .dot.active{background:#00000060}
    .dot.done{background:#000000cc}
    .title-sm{font-size:12px;color:#555;margin-bottom:6px}
    .title-lg{font-size:18px;font-weight:600;margin:0 0 6px}
    .badge{display:inline-flex;align-items:center;border:1px solid #00000030;border-radius:999px;padding:2px 8px;font-size:12px}
    .space{height:16px}
    .sticky-actions{position:fixed;right:24px;bottom:24px;display:none;gap:8px;z-index:9999}
    .sticky-actions .btn{box-shadow:0 6px 20px rgba(0,0,0,.18)}
    @media print{.noprint{display:none}!important; body{background:#fff}}
  </style>
  <!-- Libraries for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
  <div class="container">
    <header style="display:flex;gap:16px;flex-wrap:wrap;align-items:flex-end;justify-content:space-between;margin-bottom:20px">
      <div>
        <h1>ì „ëµë¬¼ì 1ì°¨ ìê°€íŒë³„ <span style="font-weight:400">(í”„ë¡œí† íƒ€ì…)</span></h1>
        <p class="muted" style="margin-top:6px;line-height:1.6">ë³¸ ë„êµ¬ëŠ” ì¼ë°˜ì¸ì„ ìœ„í•œ <b>ì‚¬ì „ ìŠ¤í¬ë¦¬ë‹</b> ìš©ë„ì…ë‹ˆë‹¤. ì‹¤ì œ ìˆ˜ì¶œì… ì „ì—ëŠ” ë°˜ë“œì‹œ
          <a href="https://yestrade.go.kr" target="_blank" rel="noreferrer">ì „ëµë¬¼ìê´€ë¦¬ì‹œìŠ¤í…œ(YES)</a>ì˜ <b>ê³µì‹ íŒì •</b>ì„ ë°›ìœ¼ì„¸ìš”.</p>
      </div>
      <div class="chips">
        <span class="chip">10ë¬¸í•­ Â· Yes/No</span>
        <span class="chip">ë¯¼ê° í’ˆëª© 1ì°¨ ì²´í¬</span>
      </div>
    </header>

    <section style="margin-bottom:16px">
      <div class="title-sm" style="display:flex;justify-content:space-between"><span>ì§„í–‰ë¥ </span><span id="pct">0%</span></div>
      <div class="progress"><div id="bar" class="bar"></div></div>
      <div class="dotline" id="dots" style="margin-top:10px"></div>
    </section>

    <main id="stage"></main>

    <footer class="card" style="margin-top:24px">
      <p class="title-sm" style="margin:0 0 6px"><b>ì¤‘ìš” ê³ ì§€(Disclaimer)</b></p>
      <p class="muted" style="line-height:1.6">ë³¸ ë„êµ¬ëŠ” ì¼ë°˜ ì •ë³´ ì œê³µ ëª©ì ì˜ í”„ë¡œí† íƒ€ì…ì´ë©° ë²•ë¥ /í–‰ì • ìë¬¸ì´ ì•„ë‹™ë‹ˆë‹¤. ì‹¤ì œ ì „ëµë¬¼ì í•´ë‹¹ ì—¬ë¶€ì™€ ìˆ˜ì¶œí—ˆê°€ í•„ìš”ì„±ì€ <b>ê´€í• ê¸°ê´€ì˜ ê³µì‹ íŒì •</b>ì— ë”°ë¦…ë‹ˆë‹¤. ìµœì‹  ê¸°ì¤€/ì ˆì°¨ëŠ” ì „ëµë¬¼ìê´€ë¦¬ì› ë° YES ê³µì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
    </footer>
  </div>

  <!-- í™”ë©´ ì˜¤ë¥¸ìª½ ì•„ë˜ ê³ ì • ì•¡ì…˜ (ê²°ê³¼ ë‹¨ê³„ì—ì„œë§Œ ë³´ì„) -->
  <div id="stickyActions" class="sticky-actions noprint">
    <button id="stickyPrint" class="btn">ê²°ê³¼ ì¸ì‡„</button>
    <button id="stickyPdf" class="btn success">ê²°ê³¼ PDF ë‹¤ìš´ë¡œë“œ</button>
  </div>

  <script>
  // ===== ë°ì´í„° =====
  const QUESTIONS = [
    {id:"q1", title:"ì†Œì¬/í’ˆëª© ë¶„ë¥˜", text:"í•´ë‹¹ í’ˆëª©ì´ ê¸ˆì†Â·í•©ê¸ˆÂ·í™”í•™ë¬¼ì§ˆÂ·ì „ìë¶€í’ˆÂ·ì •ë°€ì¥ë¹„ ë“± í†µì œëŒ€ìƒ ê°€ëŠ¥ì„±ì´ ë†’ì€ ë²”ì£¼ì— í•´ë‹¹í•˜ë‚˜ìš”?"},
    {id:"q2", title:"ì´ì¤‘ìš©ë„(Dual-use)", text:"ë¯¼ìˆ˜ìš©ê³¼ êµ°ìˆ˜ìš©(êµ­ë°©Â·ì•ˆë³´ ê´€ë ¨)ìœ¼ë¡œ ëª¨ë‘ ì‚¬ìš©ë  ê°€ëŠ¥ì„±ì´ ìˆë‚˜ìš”?"},
    {id:"q3", title:"ë¶„ë¥˜ë²ˆí˜¸ í™•ì¸", text:"HS Codeë‚˜ ìˆ˜ì¶œí†µì œë²ˆí˜¸(ECCN ë“±) ì¡°íšŒ ì‹œ ì „ëµë¬¼ì ëª©ë¡ê³¼ ìœ ì‚¬/ì—°ê´€ í•­ëª©ìœ¼ë¡œ í™•ì¸ë˜ì—ˆë‚˜ìš”?"},
    {id:"q4", title:"ìµœì¢… ì‚¬ìš©ì²˜(End-Use)", text:"ìµœì¢… ì‚¬ìš© ëª©ì ì— êµ°ì‚¬Â·ë¯¸ì‚¬ì¼Â·ì›ìë ¥Â·ìš°ì£¼ì‚°ì—…Â·ë¬´ì¸í•­ê³µê¸° ë“± ë¯¼ê° ì˜ì—­ì´ í¬í•¨ë˜ë‚˜ìš”?"},
    {id:"q5", title:"ìµœì¢… ì‚¬ìš©ì(End-User)", text:"ê±°ë˜ ìƒëŒ€ë°©ì´ ì œì¬ ëŒ€ìƒ(ê°œì¸Â·ê¸°ì—…Â·ê¸°ê´€) ë˜ëŠ” êµ° ê´€ë ¨ ê¸°ê´€ì¼ ê°€ëŠ¥ì„±ì´ ìˆë‚˜ìš”?"},
    {id:"q6", title:"í•µì‹¬ ì„±ëŠ¥ ì„ê³„ì¹˜", text:"ì†ë„Â·ì¶œë ¥Â·ì••ë ¥Â·í•´ìƒë„Â·ê°ë„ ë“± í•µì‹¬ ìŠ¤í™ì´ íŠ¹ì • ì„ê³„ì¹˜ë¥¼ ì´ˆê³¼í•˜ë‚˜ìš”?"},
    {id:"q7", title:"WMD ê´€ë ¨ì„±", text:"í•µÂ·ìƒí™”í•™ ë¬¼ì§ˆ, ë°©ì‚¬ì„± ë™ìœ„ì›ì†Œ, ë³‘ì›ì²´ ë“± ëŒ€ëŸ‰ì‚´ìƒë¬´ê¸°(WMD) ê´€ë ¨ ê°€ëŠ¥ì„±ì´ ìˆë‚˜ìš”?"},
    {id:"q8", title:"ì›ì‚°ì§€Â·ê²½ìœ ì§€", text:"ì „ëµë¬¼ì í†µì œ ë˜ëŠ” ìš°íšŒê²½ìœ  ìœ„í—˜ì´ ë†’ì€ êµ­ê°€ê°€ ì›ì‚°ì§€Â·ê²½ìœ ì§€Â·ìµœì¢…ëª©ì ì§€ì— í¬í•¨ë˜ë‚˜ìš”?"},
    {id:"q9", title:"ê³¼ê±° í—ˆê°€Â·íŒì • ì´ë ¥", text:"ë™ì¼/ìœ ì‚¬ í’ˆëª©ìœ¼ë¡œ ê³¼ê±° ì •ë¶€ í—ˆê°€ ë˜ëŠ” ì „ëµë¬¼ì íŒì •ì„ ë°›ì€ ì ì´ ìˆë‚˜ìš”?"},
    {id:"q10", title:"ê³µì‹ ì¡°íšŒ(YES)", text:"ì „ëµë¬¼ìê´€ë¦¬ì‹œìŠ¤í…œ(YES)ì—ì„œ í’ˆëª© íŒì •(ë˜ëŠ” ì‚¬ì „íŒì •) ì¡°íšŒë¥¼ ì§„í–‰í–ˆë‚˜ìš”?"},
  ];

  // ===== ìƒíƒœ =====
  const state = { step: 0, answers: Object.fromEntries(QUESTIONS.map(q=>[q.id,null])) };
  const total = QUESTIONS.length;

  // ===== ìœ í‹¸ =====
  const $ = (sel,ctx=document)=>ctx.querySelector(sel);
  const el = (tag, cls, txt) => { const n=document.createElement(tag); if(cls) n.className=cls; if(txt!=null) n.textContent=txt; return n; };
  const yesCount = () => Object.values(state.answers).filter(v=>v===true).length;
  const progressPct = () => Math.round((Math.min(state.step, total) / total) * 100);

  function renderDots(){
    const wrap = $("#dots");
    wrap.innerHTML = "";
    for(let i=0;i<total;i++){
      const d = el('div','dot'+(i<state.step?' done':(i===state.step?' active':'')));
      wrap.appendChild(d);
    }
  }

  // ---- PDF ë‚´ë³´ë‚´ê¸° (html2canvas + jsPDF) ----
  function exportPDF(){
    if(!window.jspdf || !window.html2canvas){
      alert("PDF ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
      return;
    }
    const exportArea = document.getElementById('exportArea');
    if(!exportArea){
      alert("ê²°ê³¼ í™”ë©´ì—ì„œë§Œ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆì–´ìš”. ë¬¸ë‹µì„ ë§ˆì¹œ ë’¤ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
      return;
    }

    const margin = 42; // 15mm
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p','pt','a4');
    const pageWidth = pdf.internal.pageSize.getWidth();
    const pageHeight = pdf.internal.pageSize.getHeight();
    const contentWidth = pageWidth - margin*2;
    const contentHeight = pageHeight - margin*2;

    window.html2canvas(exportArea, {scale: 2, background: '#ffffff', useCORS: true}).then(canvas => {
      const imgWidth = contentWidth;
      const imgHeight = canvas.height * imgWidth / canvas.width;

      if(imgHeight <= contentHeight){
        const imgData = canvas.toDataURL('image/png');
        pdf.addImage(imgData, 'PNG', margin, margin, imgWidth, imgHeight);
      } else {
        // ì—¬ëŸ¬ í˜ì´ì§€ë¡œ ë¶„í• 
        const pageCanvas = document.createElement('canvas');
        const pageCtx = pageCanvas.getContext('2d');
        const pageHeightPx = Math.floor(canvas.width * (contentHeight / imgWidth));
        pageCanvas.width = canvas.width;
        pageCanvas.height = pageHeightPx;

        let renderedHeight = 0;
        while(renderedHeight < canvas.height){
          pageCtx.clearRect(0,0,pageCanvas.width,pageCanvas.height);
          pageCtx.drawImage(canvas, 0, renderedHeight, canvas.width, pageHeightPx, 0, 0, canvas.width, pageHeightPx);
          const imgData = pageCanvas.toDataURL('image/png');
          if(renderedHeight > 0) pdf.addPage();
          pdf.addImage(imgData, 'PNG', margin, margin, imgWidth, contentHeight);
          renderedHeight += pageHeightPx;
        }
      }

      const stamp = new Date().toISOString().slice(0,19).replace(/[-:T]/g,'');
      pdf.save(`selfcheck_result_${stamp}.pdf`);
    }).catch(err => {
      console.error(err);
      alert("PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + err.message);
    });
  }

  function renderStage(){
    const stage = $("#stage");
    stage.innerHTML = "";

    // ì§„í–‰ë¥ 
    $("#pct").textContent = progressPct()+"%";
    $("#bar").style.width = progressPct()+"%";
    renderDots();

    // ê³ ì • ì•¡ì…˜ ì´ˆê¸°í™”
    const sticky = document.getElementById('stickyActions');
    const stickyPrint = document.getElementById('stickyPrint');
    const stickyPdf = document.getElementById('stickyPdf');
    sticky.style.display = 'none';
    stickyPrint.onclick = () => window.print();
    stickyPdf.onclick = exportPDF;

    if(state.step < total){
      const q = QUESTIONS[state.step];
      const card = el('div','card');

      const meta = el('div','title-sm muted');
      meta.innerHTML = `Q${String(state.step+1).padStart(2,'0')} Â· ${q.title}`;

      const title = el('div','title-lg', q.text);
      const tip = el('div','muted'); tip.style.fontSize='12px'; tip.style.marginBottom='12px'; tip.textContent = `ğŸ’¡ ê´€ë ¨ì„±/ìš©ë„ ë“±ì„ ì‹ ì¤‘íˆ ê²€í† í•˜ì„¸ìš”.`;

      const row = el('div','row');
      const yesBtn = el('button','btn primary','Yes');
      const noBtn = el('button','btn','No');
      const skipBtn = el('button','btn ghost','ê±´ë„ˆë›°ê¸°'); skipBtn.title='ì¼ë‹¨ ë„˜ì–´ê°”ë‹¤ê°€ ë‹¤ì‹œ ëŒì•„ì™€ë„ ë©ë‹ˆë‹¤';

      yesBtn.onclick = ()=>{ state.answers[q.id]=true; setTimeout(()=>{state.step=Math.min(state.step+1,total); renderStage();},120); };
      noBtn.onclick = ()=>{ state.answers[q.id]=false; setTimeout(()=>{state.step=Math.min(state.step+1,total); renderStage();},120); };
      skipBtn.onclick = ()=>{ state.step=Math.min(state.step+1,total); renderStage(); };

      row.append(yesBtn,noBtn,skipBtn);

      const nav = el('div','muted'); nav.style.display='flex'; nav.style.justifyContent='space-between'; nav.style.marginTop='14px'; nav.style.fontSize='12px';
      const prev = el('button','btn link','â† ì´ì „'); prev.onclick=()=>{state.step=Math.max(0,state.step-1); renderStage();};
      const tally = el('div',null,`ë‹µë³€: ${yesCount()}ê°œ Yes`);
      nav.append(prev,tally);

      card.append(meta,title,tip,row,nav);
      stage.append(card);
    } else {
      // ê²°ê³¼ í™”ë©´
      sticky.style.display = 'flex'; // ê³ ì • ì•¡ì…˜ ë³´ì—¬ì£¼ê¸°

      const ratio = yesCount()/total; let level='low', title='ì „ëµë¬¼ì ê°€ëŠ¥ì„± ë‚®ìŒ', note='ë¦¬ìŠ¤í¬ê°€ ë‚®ì•„ ë³´ì´ì§€ë§Œ í•µì‹¬ í¬ì¸íŠ¸ë¥¼ ì¬í™•ì¸í•˜ì„¸ìš”.';
      if(ratio>=0.6){ level='high'; title='ì „ëµë¬¼ì ê°€ëŠ¥ì„± ë†’ìŒ'; note='ê³µì‹ íŒì •(YES) ë° ìˆ˜ì¶œí—ˆê°€ ê²€í† ë¥¼ ì¦‰ì‹œ ì§„í–‰í•˜ì„¸ìš”.'; }
      else if(ratio>=0.3){ level='mid'; title='ì „ëµë¬¼ì ê°€ëŠ¥ì„± ì¤‘ê°„'; note='YES ì‚¬ì „íŒì •ê³¼ ìŠ¤í™Â·ê²½ë¡œ ì ê²€ì„ ì§„í–‰í•˜ì„¸ìš”.'; }

      const exportWrap = el('div'); exportWrap.id = 'exportArea';

      // --- ìƒë‹¨ ê²°ê³¼ ìš”ì•½ ì¹´ë“œ + ë²„íŠ¼ ---
      const summary = el('div','card');
      const smh = el('div','title-sm muted','ê²°ê³¼ ìš”ì•½');
      const h3 = el('h3',null,title); h3.style.margin='2px 0 8px'; h3.style.fontSize='22px';
      const p = el('p','muted',note); p.style.lineHeight='1.6'; p.style.marginBottom='12px';

      const stats = el('div'); stats.style.display='flex'; stats.style.alignItems='center'; stats.style.gap='14px';
      const big = el('div',null, String(yesCount())); big.style.fontSize='28px'; big.style.fontWeight='800';
      const small = el('div','muted',`/ ${total} ë¬¸í•­ Yes`);

      const barWrap = el('div','progress'); barWrap.style.marginTop='14px';
      const bar = el('div','bar'); bar.style.width = Math.round(ratio*100)+'%'; barWrap.append(bar);

      const topActions = el('div','row noprint');
      const printBtnTop = el('button','btn','ê²°ê³¼ ì¸ì‡„'); printBtnTop.onclick=()=>window.print();
      const pdfBtnTop = el('button','btn success','ê²°ê³¼ PDF ë‹¤ìš´ë¡œë“œ'); pdfBtnTop.onclick=exportPDF;
      topActions.style.marginTop='12px';
      topActions.append(printBtnTop,pdfBtnTop);

      stats.append(big,small); summary.append(smh,h3,p,stats,barWrap,topActions);

      // --- ë‹µë³€ ê²€í†  í…Œì´ë¸” ---
      const table = el('div','card');
      const th4 = el('h4',null,'ë‹µë³€ ê²€í† '); th4.style.margin='0 0 12px'; th4.style.fontSize='18px';
      const wrap = el('div'); wrap.style.overflowX='auto';
      const tbl = el('table');
      tbl.innerHTML = `<thead><tr><th>ë¬¸í•­</th><th>ì œëª©</th><th>ë‹µë³€</th></tr></thead>`;
      const tbody = el('tbody');
      QUESTIONS.forEach((q,i)=>{
        const tr = el('tr');
        const td1 = el('td',null,'Q'+String(i+1).padStart(2,'0'));
        td1.style.color='#444';
        const td2 = el('td'); td2.textContent = q.title;
        const td3 = el('td');
        const v = state.answers[q.id];
        td3.innerHTML = v===null? '<span style="color:#999">(ë¯¸ì‘ë‹µ)</span>' : (v? '<b>Yes</b>' : 'No');
        tr.append(td1,td2,td3); tbody.append(tr);
      });
      tbl.append(tbody); wrap.append(tbl); table.append(th4,wrap);

      exportWrap.append(summary, document.createElement('div'));
      exportWrap.lastChild.className='space';
      exportWrap.append(table);

      // í•˜ë‹¨ ì•ˆë‚´/ë¦¬ì…‹ ì¹´ë“œ
      const actions = el('div','card noprint');
      const h4 = el('h4',null,'ë‹¤ìŒ ë‹¨ê³„'); h4.style.margin='0 0 10px'; h4.style.fontSize='18px';
      const ol = el('ol'); ol.style.paddingLeft='18px'; ol.style.lineHeight='1.6';
      ol.innerHTML = `<li><a href="https://yestrade.go.kr" target="_blank" rel="noreferrer">ì „ëµë¬¼ìê´€ë¦¬ì‹œìŠ¤í…œ(YES)</a>ì—ì„œ <b>í’ˆëª©(ì‚¬ì „)íŒì •</b>ì„ ì§„í–‰í•©ë‹ˆë‹¤.</li>
                      <li><b>ìµœì¢…ì‚¬ìš©ì/ìµœì¢…ì‚¬ìš©ì²˜/ê²½ìœ ì§€</b> ë¬¸ì„œë¥¼ ì •ë¦¬í•˜ì—¬ ë¦¬ìŠ¤í¬ë¥¼ ì¬ì ê²€í•©ë‹ˆë‹¤.</li>
                      <li>ìˆ˜ì¶œí—ˆê°€ê°€ í•„ìš”í•œ ê²½ìš°, ê´€í•  ê¸°ê´€ ì•ˆë‚´ì— ë”°ë¼ <b>í—ˆê°€ ì‹ ì²­</b>ì„ ì¤€ë¹„í•©ë‹ˆë‹¤.</li>`;
      const btns = el('div'); btns.style.display='flex'; btns.style.flexWrap='wrap'; btns.style.gap='8px'; btns.style.marginTop='14px';
      const reset = el('button','btn primary','ë‹¤ì‹œ ì‹œì‘'); reset.onclick=()=>{state.step=0; state.answers=Object.fromEntries(QUESTIONS.map(q=>[q.id,null])); renderStage();};
      const printBtn = el('button','btn', 'ê²°ê³¼ ì¸ì‡„'); printBtn.onclick=()=>window.print();
      const pdfBtn = el('button','btn success', 'ê²°ê³¼ PDF ë‹¤ìš´ë¡œë“œ'); pdfBtn.onclick=exportPDF;
      btns.append(reset,printBtn,pdfBtn);
      actions.append(h4,ol,btns);

      stage.append(exportWrap, document.createElement('div')).lastChild.className='space';
      stage.append(actions);
    }
  }

  // ì´ˆê¸° ë Œë”
  renderStage();
  </script>
</body>
</html>
